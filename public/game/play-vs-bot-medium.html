<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quizania - Medium Bot Battle</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
	 <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          animation: {
            fadeIn: 'fadeIn 0.5s ease-in-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            }
          }
        }
      }
    };
  </script>
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .sidebar a { display: flex; align-items: center; gap: 0.5rem; }
    .overlay { background: rgba(0, 0, 0, 0.5); }
    @media (max-width: 768px) {
      .sidebar { width: 70%; max-width: 280px; height: 100vh; position: fixed; top: 0; left: -100%; z-index: 40; transition: all 0.3s ease; }
      .sidebar.open { left: 0; }
      .mobile-overlay { display: none; }
      .mobile-overlay.show { display: block; position: fixed; inset: 0; z-index: 30; }
    }
	html body > .skiptranslate {
  display: none !important;
}
body {
  top: 0px !important;
}
#google_translate_element,
.goog-te-banner-frame.skiptranslate,
.goog-te-gadget-icon,
.goog-te-gadget-simple {
  display: none !important;
}

  </style>
    <style>
        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a40 100%);
            font-family: 'Inter', sans-serif;
        }
        .quiz-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .option-btn {
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .option-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
        }
        .option-btn.selected {
            background: rgba(34, 197, 94, 0.2);
            border-color: #22c55e;
        }
        .timer-bar {
            transition: width 0.1s linear;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #22c55e);
        }
        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        .progress-item {
            transition: all 0.3s ease;
        }
        .progress-item.active {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
        }
        .progress-item.completed {
            background: rgba(34, 197, 94, 0.2);
            border-color: #22c55e;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body class="min-h-screen text-white overflow-x-hidden">



<!-- Mobile Navbar -->
<div class="sm:hidden flex justify-between items-center p-4 bg-blue-900 text-white">
  <button onclick="toggleSidebar()">‚ò∞</button>
  <h1 class="font-bold">Quizania</h1>
</div>

<!-- Sidebar Overlay for Mobile -->
<div id="mobileOverlay" class="mobile-overlay overlay"></div>

<div class="flex min-h-screen">
  <!-- Sidebar -->
  <div id="sidebar" class="sidebar bg-blue-900 text-white flex flex-col px-4 py-4 sm:relative sm:w-60 w-full sm:translate-x-0">
    <div class="flex items-center mb-6 space-x-2">
      <img id="profilePreview" src="" alt="Profile" class="w-10 h-10 rounded-full border-2 border-white cursor-pointer" />
      <span class="text-lg font-bold hidden sm:block">Quizania</span>
      <input type="file" id="profilePhoto" accept="image/*" class="hidden" />
    </div>
    <nav class="space-y-2">
      <a href="/dashboard.html">üè† Home</a>
      <a href="/profile-edit.html">üë§ Profile</a>
      <a href="/msg.html">‚úâÔ∏è Messages</a>
      <a href="/play.html">‚ñ∂Ô∏è Play</a>
      <a href="#">ü§ù Refer & Earn</a>
      <a href="#">‚öôÔ∏è Setting</a>
      <a href="#">üìù Feedback</a>
    </nav>
    <button onclick="toggleTheme()" class="mt-4 bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-sm">Dark</button>
    <button onclick="logout()" class="mt-2 bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-sm">Logout</button>
  </div>

    <!-- Entry Screen -->
    <div id="entryScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="quiz-container rounded-2xl p-8 max-w-md w-full text-center">
            <div class="mb-6">
                <i class="fas fa-robot text-6xl text-blue-400 mb-4"></i>
                <h1 class="text-3xl font-bold text-white mb-2">Medium Bot Battle</h1>
                <p class="text-gray-300">Test your knowledge against our AI bot!</p>
            </div>
            
            
            <div class="mb-6 p-4 bg-green-900/20 border border-green-500/30 rounded-lg">
                <p class="text-green-300 text-sm">
                    <i class="fas fa-trophy mr-2"></i>
                    Beat the bot and win <span class="font-bold text-yellow-400">2√ó</span> your entry amount!
                </p>
            </div>
            
            <button onclick="startGame()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                <i class="fas fa-play mr-2"></i>Start Battle
            </button>
        </div>
    </div>

    <!-- Quiz Screen -->
    <div id="quizScreen" class="min-h-screen p-4 hidden">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="flex flex-col lg:flex-row gap-6 mb-6">
                <div class="quiz-container rounded-xl p-6 flex-1">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold">Question <span id="currentQuestion">1</span>/10</h2>
                        <div class="flex items-center space-x-4">
                            <div class="text-right">
                                <p class="text-sm text-gray-400">Time Left</p>
                                <p class="text-2xl font-bold text-yellow-400" id="timeLeft">10</p>
                            </div>
                        </div>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2 mb-6">
                        <div id="timerBar" class="timer-bar h-2 rounded-full" style="width: 100%"></div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col lg:flex-row gap-6">
                <!-- Main Quiz Area -->
                <div class="flex-1">
                    <div class="quiz-container rounded-xl p-6 mb-6">
                        <h3 id="questionText" class="text-xl mb-6 leading-relaxed"></h3>
<img id="question-image" class="mb-4 max-w-full" alt="Question Image" style="display:none;" />



                        <div id="optionsContainer" class="space-y-3"></div>
                    </div>
                </div>

                <!-- Progress Sidebar -->
                <div class="lg:w-80">
                    <div class="quiz-container rounded-xl p-6">
                        <h4 class="text-lg font-bold mb-4">Battle Progress</h4>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-blue-400"><i class="fas fa-user mr-2"></i>You</span>
                                <span class="text-red-400"><i class="fas fa-robot mr-2"></i>Bot</span>
                            </div>
                            <div id="progressContainer" class="space-y-2"></div>
                        </div>
                        
                        <!-- Bot Status -->

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Result Screen -->
    <div id="resultScreen" class="min-h-screen flex items-center justify-center p-4 hidden">
        <div class="quiz-container rounded-2xl p-8 max-w-2xl w-full">
            <div class="text-center mb-8">
                <div id="resultIcon" class="text-6xl mb-4"></div>
                <h2 id="resultTitle" class="text-3xl font-bold mb-2"></h2>
                <p id="resultSubtitle" class="text-gray-300"></p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-6 text-center">
                    <i class="fas fa-user text-blue-400 text-2xl mb-2"></i>
                    <h3 class="text-lg font-semibold mb-2">Your Score</h3>
                    <p id="userScore" class="text-3xl font-bold text-blue-400"></p>
                    <p class="text-sm text-gray-400 mt-1">Avg Time: <span id="userAvgTime"></span>s</p>
                </div>
                <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-6 text-center">
                    <i class="fas fa-robot text-red-400 text-2xl mb-2"></i>
                    <h3 class="text-lg font-semibold mb-2">Bot Score</h3>
                    <p id="botScore" class="text-3xl font-bold text-red-400"></p>
                    <p class="text-sm text-gray-400 mt-1">Avg Time: <span id="botAvgTime"></span>s</p>
                </div>
            </div>

            <div id="winningSection" class="bg-green-900/20 border border-green-500/30 rounded-lg p-6 mb-6 text-center hidden">
                <i class="fas fa-trophy text-yellow-400 text-3xl mb-3"></i>
                <h3 class="text-xl font-bold text-green-400 mb-2">Congratulations!</h3>
                <p class="text-2xl font-bold text-yellow-400">You Won ‚Çπ<span id="winAmount"></span>!</p>
                <p class="text-sm text-gray-300 mt-2">Amount added to your wallet</p>
            </div>

            <div class="flex flex-col sm:flex-row gap-4">
                <button onclick="location.href='bot.html'" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    <i class="fas fa-redo mr-2"></i>Play Again
                </button>
                <button onclick="goHome()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    <i class="fas fa-home mr-2"></i>Dashboard
                </button>
            </div>
        </div>
    </div>

    <!-- Confetti Canvas -->
    <canvas id="confettiCanvas" class="confetti hidden"></canvas>

 <div id="google_translate_element" style="display: none;"></div>

<script type="text/javascript">
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'en,hi',
      autoDisplay: false
    }, 'google_translate_element');
  }
</script>
<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script>
  function translatePage(code) {
    const dropdown = document.querySelector("#google_translate_element select");
    if (!dropdown) return;
    dropdown.value = code;
    dropdown.dispatchEvent(new Event("change"));
  }

  window.addEventListener("load", () => {
    const savedLang = localStorage.getItem("quizania_lang");
    if (savedLang) {
      const waitForDropdown = setInterval(() => {
        const sel = document.querySelector("#google_translate_element select");
        if (sel) {
          clearInterval(waitForDropdown);
          translatePage(savedLang);
        }
      }, 500);
    }
  });
</script>
 
  
</div>

<!-- Firebase Auth & Profile Logic -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, increment, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBt_ygYw6AgCcOlQYcMAn3rw6Q325IRyy4",
    authDomain: "quizania-b8292.firebaseapp.com",
    projectId: "quizania-b8292",
    storageBucket: "quizania-b8292.appspot.com",
    messagingSenderId: "94747680142",
    appId: "1:94747680142:web:520ef8559cfe766f0c58df",
    measurementId: "G-YM2LZBJNCY"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const profilePreview = document.getElementById("profilePreview");
  const profilePhotoInput = document.getElementById("profilePhoto");

  profilePreview.addEventListener("click", () => profilePhotoInput.click());
  profilePhotoInput.addEventListener("change", async () => {
    const file = profilePhotoInput.files[0];
    if (!file) return;

    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", "Profile photo");

    const response = await fetch("https://api.cloudinary.com/v1_1/dkzjcmkha/upload", {
      method: "POST",
      body: formData
    });
    const data = await response.json();
    if (data.secure_url) {
      const user = auth.currentUser;
      const userRef = doc(db, "users", user.uid);
      await setDoc(userRef, { profilePhoto: data.secure_url }, { merge: true });
      profilePreview.src = data.secure_url;
    }
  });

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const uid = user.uid;
      const docRef = doc(db, "users", uid);
      let docSnap = await getDoc(docRef);

      if (!docSnap.exists()) {
        const defaultData = {
          name: user.email,
          rechargeWallet: 0,
          winningWallet: 0,
          profilePhoto: "",
          isAdmin: false,
          matchHistory: []
        };
        await setDoc(docRef, defaultData);
        docSnap = await getDoc(docRef);
      }


      const data = docSnap.data();
      document.getElementById("recharge-wallet").innerText = data.rechargeWallet || 0;
      document.getElementById("winning-wallet").innerText = data.winningWallet || 0;
      if (data.profilePhoto) profilePreview.src = data.profilePhoto;
    } else {
      window.location.href = "login.html";
    }
  });
window.toggleSidebar = function () {
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("mobileOverlay");
  sidebar.classList.toggle("open");
  overlay.classList.toggle("show");
  overlay.onclick = () => {
    sidebar.classList.remove("open");
    overlay.classList.remove("show");
  };
};
  function toggleTheme() {
    document.documentElement.classList.toggle("dark");
  }
  window.withdraw = function () {
    alert("Withdraw coming soon!");
  }
  window.logout = function () {
    signOut(auth).then(() => window.location.href = 'login.html');
  }
    window.recharge = async function () {
    const amountStr = prompt("Enter recharge amount:");
    const amount = parseFloat(amountStr);
    if (isNaN(amount) || amount <= 0) return alert("Invalid amount.");
    const fee = amount <= 100 ? 2 : 0;
    const net = amount - fee;

    const userRef = doc(db, "users", currentUser.uid);
    await updateDoc(userRef, { rechargeWallet: increment(net) });

    const adminRef = doc(db, "admin", "fees");
    await updateDoc(adminRef, { totalRechargeFee: increment(fee) }).catch(() =>
      setDoc(adminRef, { totalRechargeFee: fee }, { merge: true })
    );

    alert(`‚Çπ${net} added. ‚Çπ${fee} fee charged.`);
    const snap = await getDoc(userRef);
    document.getElementById("recharge-wallet").innerText = snap.data().rechargeWallet || 0;
  }

  window.withdraw = () => alert("Withdraw coming soon!");
  
  // Expose Firebase functions and instances globally
window.auth = auth;
window.db = db;
window.doc = doc;
window.setDoc = setDoc;
window.getDoc = getDoc;
window.increment = increment;

</script>

    <script>
        // Game State
        let currentGameState = {
            playAmount: 0,
            currentQuestionIndex: 0,
            userAnswers: [],
            userScore: 0,
            botScore: 0,
            selectedQuestions: [],
            startTime: 0,
            questionStartTime: 0,
            userTimes: [],
            botTimes: [],
            gameTimer: null,
            botTimer: null,
			    gameEnded: false 
        };
const botLevel = "medium";
        // Questions Pool (30 questions)
const questionsPool = 
[
    {
        question: "Identify this famous scientist known for the photoelectric effect.",
        img: "https://i.ibb.co/GvgkfDKz/download.jpg",
        options: ["Albert Einstein", "Max Planck", "Niels Bohr", "Erwin Schr√∂dinger"],
        correct: 0
    },
    {
        question: "This ancient structure is located in which country?",
        img: "https://i.ibb.co/m53PHhDc/download.jpg",
        options: ["Japan", "India", "China", "South Korea"],
        correct: 2
    },
    {
        question: "Which type of galaxy is shown in this image?",
        img: "https://i.ibb.co/CKXvfgcw/download.jpg",
        options: ["Elliptical", "Irregular", "Spiral", "Lenticular"],
        correct: 2
    },
    {
        question: "Identify this mathematical genius from India.",
        img: "https://i.ibb.co/JFR7fq7R/download.jpg",
        options: ["Satyendra Nath Bose", "C.V. Raman", "Homi Bhabha", "Srinivasa Ramanujan"],
        correct: 3
    },
    {
        question: "Which molecule is shown in this structural diagram?",
        img: "https://i.ibb.co/mVD8NCf9/download.png",
        options: ["Fructose", "Sucrose", "Glucose", "Lactose"],
        correct: 2
    },
    {
        question: "This satellite image shows which famous desert?",
        img: "https://i.ibb.co/v6RxtCtf/download.jpg",
        options: ["Gobi", "Kalahari", "Thar", "Sahara"],
        correct: 3
    },
    {
        question: "This weapon was used in which era?",
        img: "https://i.ibb.co/9HvKmd9n/download.jpg",
        options: ["Stone Age", "Iron Age", "Medieval Age", "Renaissance"],
        correct: 2
    },
    {
        question: "Identify the famous painting shown.",
        img: "https://i.ibb.co/TMFT5Z5p/download.jpg",
        options: ["The School of Athens", "The Last Supper", "Guernica", "The Creation of Adam"],
        correct: 0
    },
    {
        question: "Which computer model is this, known as the first personal computer?",
        img: "https://i.ibb.co/svNcCkH4/download.jpg",
        options: ["IBM 5100", "Altair 8800", "Apple I", "PDP-8"],
        correct: 1
    },
    {
        question: "Which architectural style does this cathedral represent?",
        img: "https://i.ibb.co/8Dv8PVRF/download.jpg",
        options: ["Baroque", "Romanesque", "Gothic", "Renaissance"],
        correct: 2
    },
    {
        question: "Which city is seen in this aerial view?",
        img: "https://i.ibb.co/0jWHmXsz/download.jpg",
        options: ["Chicago", "New York City", "Los Angeles", "London"],
        correct: 1
    },
    {
        question: "This animal belongs to which biological class?",
        img: "https://i.ibb.co/TMdfbLt4/download.jpg",
        options: ["Mammalia", "Reptilia", "Aves", "Amphibia"],
        correct: 0
    },
    {
        question: "What type of chemical reaction is represented in this image?",
        img: "https://i.ibb.co/fGDnqtpY/download.jpg",
        options: ["Combustion", "Neutralization", "Precipitation", "Displacement"],
        correct: 0
    },
    {
        question: "Which spacecraft captured this image of Saturn?",
        img: "https://i.ibb.co/xtCb0zvz/download.jpg",
        options: ["Voyager 1", "New Horizons", "Galileo", "Cassini"],
        correct: 3
    },
    {
        question: "This sculpture is associated with which ancient civilization?",
        img: "https://i.ibb.co/jvGGK3zZ/download.jpg",
        options: ["Egyptian", "Greek", "Akkadian", "Indus Valley"],
        correct: 2
    },
    {
        question: "Which famous volcano is shown in the image?",
        img: "https://i.ibb.co/Ngh89ksB/download.jpg",
        options: ["Mount Etna", "Mount Vesuvius", "Mount Fuji", "Mount St. Helens"],
        correct: 1
    },
    {
        question: "Identify this bacterial cell structure.",
        img: "https://i.ibb.co/YFHW27LP/download.jpg",
        options: ["Ribosome", "Capsule", "Endospore", "Pili"],
        correct: 3
    },
    {
        question: "Which famous satellite dish is shown here?",
        img: "https://i.ibb.co/TD4m4r5P/download.jpg",
        options: ["Arecibo Observatory", "Very Large Array", "FAST Telescope", "Jodrell Bank"],
        correct: 0
    },
	    {
        question: "This is a photo of which famous physicist who helped develop the quantum theory?",
        img: "https://i.ibb.co/kVy7bZPX/download.jpg",
        options: ["Niels Bohr", "Max Planck", "Werner Heisenberg", "Richard Feynman"],
        correct: 1
    },
    {
        question: "Identify this deep space object captured by Hubble.",
        img: "https://i.ibb.co/76qJksC/download.jpg",
        options: ["Andromeda Galaxy", "Hubble Deep Field", "Crab Nebula", "Milky Way Core"],
        correct: 1
    },
    {
        question: "This ancient ruin is located in which country?",
        img: "https://i.ibb.co/pBYvBrmn/download.jpg",
        options: ["Mexico", "Peru", "Chile", "Colombia"],
        correct: 1
    },
    {
        question: "What is this device used in quantum computing research?",
        img: "https://i.ibb.co/9mC5s656/download.jpg",
        options: ["Cryostat Board", "Quantum chip", "Neural net processor", "Photonic Chip"],
        correct: 1
    },
    {
        question: "This map projection is known as?",
        img: "https://i.ibb.co/3xLVtP4/download.jpg",
        options: ["Mercator", "Miller", "Robinson", "Goode"],
        correct: 0
    },

    {
        question: "This is a photo of a rare astronomical phenomenon called?",
        img: "https://i.ibb.co/8LBV6MZv/download.png",
        options: ["Solar eclipse", "Lunar eclipse", "Supernova", "Transit of Venus"],
        correct: 0
    },
    {
        question: "What is this visual structure used in data science?",
        img: "https://i.ibb.co/GvYC2Hx6/download.png",
        options: ["Flowchart", "Neural Network", "Decision Tree", "Sankey Diagram"],
        correct: 2
    },
    {
        question: "This map shows the location of which tectonic feature?",
        img: "https://i.ibb.co/fYhY6nSB/download.png",
        options: ["Mid-Atlantic Ridge", "Pacific Ring of Fire", "Great Rift Valley", "Himalayan Plate"],
        correct: 1
    },

    {
        question: "Which Nobel laureate developed the theory of bounded rationality in economics?",
        options: ["Daniel Kahneman", "Amartya Sen", "Herbert A. Simon", "Milton Friedman"],
        correct: 2
    },
    {
        question: "In quantum mechanics, what does Heisenberg's Uncertainty Principle state?",
        options: [
            "Energy and mass are interchangeable",
            "Time and space are relative",
            "Position and momentum cannot be simultaneously known with precision",
            "Light behaves only as a particle"
        ],
        correct: 2
    },
    {
        question: "Which part of the human brain is primarily responsible for forming new memories?",
        options: ["Amygdala", "Hypothalamus", "Hippocampus", "Cerebellum"],
        correct: 2
    },
    {
        question: "What is the name of the mathematical hypothesis that all non-trivial zeros of the zeta function lie on the critical line?",
        options: ["Goldbach Conjecture", "Riemann Hypothesis", "Poincar√© Conjecture", "Ramanujan Hypothesis"],
        correct: 1
    },
    {
        question: "Which particle was confirmed by CERN's LHC experiments in 2012?",
        options: ["Graviton", "Muon", "Higgs boson", "Neutrino"],
        correct: 2
    },
    {
        question: "Which Indian mathematician compiled the *Siddhanta Shiromani*?",
        options: ["Aryabhata", "Brahmagupta", "Bhaskaracharya II", "Varahamihira"],
        correct: 2
    },
    {
        question: "Which organelle in eukaryotic cells is known as the 'suicide bag'?",
        options: ["Ribosome", "Nucleus", "Lysosome", "Mitochondria"],
        correct: 2
    },
    {
        question: "Which of the following programming languages is statically typed and purely functional?",
        options: ["Python", "JavaScript", "Haskell", "Ruby"],
        correct: 2
    },
    {
        question: "What is the Schr√∂dinger equation used for?",
        options: [
            "Calculating gravitational force",
            "Modeling atomic decay",
            "Describing how quantum states evolve over time",
            "Determining the speed of light"
        ],
        correct: 2
    },
    {
        question: "Which constitutional article allows the President of India to declare President‚Äôs Rule?",
        options: ["Article 352", "Article 356", "Article 360", "Article 368"],
        correct: 1
    },
	    {
        question: "Which Indian physicist developed the theory of Raman Scattering?",
        options: ["C.V. Raman", "Meghnad Saha", "Satyendra Nath Bose", "Homi Bhabha"],
        correct: 0
    },
    {
        question: "What is the primary function of the Golgi apparatus in cells?",
        options: ["Protein synthesis", "Energy production", "Packaging and transport", "DNA replication"],
        correct: 2
    },
    {
        question: "Which planet has the strongest magnetic field in the solar system?",
        options: ["Earth", "Saturn", "Jupiter", "Neptune"],
        correct: 2
    },
    {
        question: "Which chemical element is named after a famous physicist and radioactivity pioneer?",
        options: ["Curium", "Einsteinium", "Fermium", "All of the above"],
        correct: 3
    },
    {
        question: "Which empire built the *Hawa Mahal* in Jaipur?",
        options: ["Mughals", "Mauryas", "Rajputs", "Guptas"],
        correct: 2
    },
    {
        question: "In economics, what does the 'Gini coefficient' measure?",
        options: ["GDP growth", "Inflation", "Inequality", "Market competition"],
        correct: 2
    },
    {
        question: "Which treaty ended the First World War?",
        options: ["Treaty of Paris", "Treaty of Versailles", "Treaty of Vienna", "Treaty of Utrecht"],
        correct: 1
    },
    {
        question: "What does the acronym 'IPCC' stand for in climate science?",
        options: [
            "International Panel on Climate Control",
            "Intergovernmental Panel on Climate Change",
            "International Program for Climate Change",
            "Institute for Pollution and Climate Change"
        ],
        correct: 1
    },
    {
        question: "Which dynasty issued the Allahabad Pillar Inscription?",
        options: ["Maurya", "Gupta", "Mughal", "Rashtrakuta"],
        correct: 1
    },
    {
        question: "Which blood group is considered the universal recipient?",
        options: ["O+", "AB+", "B-", "A+"],
        correct: 1
    },
    {
        question: "Which programming paradigm does Prolog follow?",
        options: ["Object-oriented", "Procedural", "Functional", "Logic-based"],
        correct: 3
    },
    {
        question: "What does the term 'mitochondria' literally mean?",
        options: ["Cell brain", "Power thread", "Thread granule", "Nucleus duplicate"],
        correct: 2
    },
    {
        question: "Who proposed the heliocentric theory of the solar system?",
        options: ["Aristotle", "Galileo", "Copernicus", "Kepler"],
        correct: 2
    },
    {
        question: "Which philosopher is known for the statement 'I think, therefore I am'?",
        options: ["Plato", "Socrates", "Descartes", "Kant"],
        correct: 2
    },
    {
        question: "Which Indian state has the largest forest cover by area?",
        options: ["Assam", "Madhya Pradesh", "Chhattisgarh", "Arunachal Pradesh"],
        correct: 1
    },
    {
        question: "Who developed the first algorithm intended for machine processing?",
        options: ["Alan Turing", "Ada Lovelace", "Charles Babbage", "John von Neumann"],
        correct: 1
    },
    {
        question: "Which satellite was the first artificial Earth satellite?",
        options: ["Sputnik 1", "Explorer 1", "Aryabhata", "Vostok 1"],
        correct: 0
    },
    {
        question: "Which language is considered the root of all Indo-European languages?",
        options: ["Sanskrit", "Latin", "Greek", "Proto-Indo-European"],
        correct: 3
    },
    {
        question: "Which Mughal emperor built the Buland Darwaza?",
        options: ["Babur", "Akbar", "Aurangzeb", "Shah Jahan"],
        correct: 1
    },
    {
        question: "Which neurotransmitter is associated with the feeling of pleasure?",
        options: ["Dopamine", "Serotonin", "Cortisol", "Epinephrine"],
        correct: 0
    },
    {
        question: "Which Indian scientist is known for the discovery of the malaria parasite in India?",
        options: ["Hargobind Khorana", "Ronald Ross", "Birbal Sahni", "Upendranath Brahmachari"],
        correct: 1
    },
    {
        question: "Which protocol is used for secure communication over the internet?",
        options: ["FTP", "HTTP", "SMTP", "HTTPS"],
        correct: 3
    },
    {
        question: "Which part of the Indian Constitution deals with Fundamental Duties?",
        options: ["Part III", "Part IV-A", "Part IV", "Part II"],
        correct: 1
    },
    {
        question: "Which gas is used in the Haber process to manufacture ammonia?",
        options: ["Oxygen", "Nitrogen", "Hydrogen", "Methane"],
        correct: 1
    },
    {
        question: "In which year was the decimal system of Indian currency adopted?",
        options: ["1947", "1950", "1957", "1962"],
        correct: 2
    },
    {
        question: "Which type of mirror is used in car side-view mirrors?",
        options: ["Concave", "Convex", "Plane", "None"],
        correct: 1
    },
    {
        question: "Which river is known as the 'Sorrow of Bihar'?",
        options: ["Yamuna", "Ganga", "Kosi", "Ghaghara"],
        correct: 2
    },
    {
        question: "Which country was formerly known as Abyssinia?",
        options: ["Ethiopia", "Sudan", "Egypt", "Somalia"],
        correct: 0
    },
    {
        question: "What is the SI unit of electric capacitance?",
        options: ["Ohm", "Farad", "Henry", "Coulomb"],
        correct: 1
    },
    {
        question: "Which virus caused the 1918 global pandemic?",
        options: ["Coronavirus", "H1N1 Influenza", "Ebola", "SARS-CoV"],
        correct: 1
    }
];




		document.getElementById('entryScreen').classList.add('hidden');
document.getElementById('quizScreen').classList.remove('hidden');

window.addEventListener("DOMContentLoaded", () => {
  window.auth.onAuthStateChanged(async (user) => {
    if (user) {
      await startGame(); // ‚úÖ only start if logged in
    } else {
      alert("You must be logged in to play.");
      window.location.href = "login.html";
    }
  });
});

document.addEventListener("visibilitychange", function () {
  if (document.hidden) {
    window.location.href = "bot.html"; // or your desired home page
  }
});

async function startGame() {
    const urlParams = new URLSearchParams(window.location.search);
    const amount = parseInt(urlParams.get("amount") || "100");

    // ‚úÖ Ensure user is logged in
    const user = window.auth.currentUser;
    if (!user) {
        alert("You must be logged in to play.");
        return window.location.href = "login.html";
    }

    const userRef = window.doc(window.db, "users", user.uid);
    const userSnap = await window.getDoc(userRef);
    const userData = userSnap.data();

    let rechargeWallet = userData.rechargeWallet || 0;
    let winningWallet = userData.winningWallet || 0;
    let totalBalance = rechargeWallet + winningWallet;

    // ‚ùå Not enough money at all
    if (totalBalance < amount) {
        alert("Not enough balance to start the game. Please recharge your wallet.");
        return;
    }

    // ‚úÖ Prepare deduction logic
    let updateData = {};

    if (rechargeWallet >= amount) {
        // üí∞ Deduct fully from recharge wallet
        updateData.rechargeWallet = window.increment(-amount);
    } else {
        // üí° Partial from recharge, remaining from winning
        const fromRecharge = rechargeWallet;
        const fromWinning = amount - fromRecharge;

        updateData.rechargeWallet = window.increment(-fromRecharge);
        updateData.winningWallet = window.increment(-fromWinning);
    }

    // ‚úÖ Deduct wallets in Firestore
    await window.setDoc(userRef, updateData, { merge: true });

    // ‚úÖ Store amount in game state
    currentGameState.playAmount = amount;
    currentGameState.selectedQuestions = getRandomQuestions(10);
    currentGameState.startTime = Date.now();

    document.getElementById('entryScreen').classList.add('hidden');
    document.getElementById('quizScreen').classList.remove('hidden');

    initializeProgress();
    showQuestion(0);
}




        function getRandomQuestions(count) {
            const shuffled = [...questionsPool].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        function initializeProgress() {
            const container = document.getElementById('progressContainer');
            container.innerHTML = '';
            
            for (let i = 0; i < 10; i++) {
                const progressItem = document.createElement('div');
                progressItem.className = 'progress-item flex items-center justify-between p-2 rounded border border-gray-600';
                progressItem.innerHTML = `
                    <span class="text-sm">Q${i + 1}</span>
                    <div class="flex space-x-2">
                        <span id="userQ${i}" class="w-3 h-3 rounded-full bg-gray-600"></span>
                        <span id="botQ${i}" class="w-3 h-3 rounded-full bg-gray-600"></span>
                    </div>
                `;
                container.appendChild(progressItem);
            }
        }


function showQuestion(index) {
    if (index >= currentGameState.selectedQuestions.length) {
        endGame();
        return;
    }

    const question = currentGameState.selectedQuestions[index];
    currentGameState.currentQuestionIndex = index;
    currentGameState.questionStartTime = Date.now();

    document.getElementById('currentQuestion').textContent = index + 1;
    document.getElementById('questionText').textContent = question.question;

  const questionText = document.getElementById("questionText");
  const questionImage = document.getElementById("question-image");

  questionText.textContent = question.question;

if (question.img) {
  questionImage.style.display = "block";
  questionImage.src = question.img + `?v=${Date.now()}`;
} else {
  questionImage.style.display = "none";
  questionImage.src = "";
}



    const optionsContainer = document.getElementById('optionsContainer');
    optionsContainer.innerHTML = '';
    question.options.forEach((option, optionIndex) => {
        const button = document.createElement('button');
        button.className = 'option-btn w-full p-4 rounded-lg text-left hover:scale-105 transform transition-all';
        button.innerHTML = `<span class="font-medium">${String.fromCharCode(65 + optionIndex)}.</span> ${option}`;
        button.onclick = () => selectAnswer(optionIndex);
        optionsContainer.appendChild(button);
    });

    const progressItems = document.querySelectorAll('.progress-item');
    progressItems.forEach((item, i) => {
        if (i === index) item.classList.add('active');
        else item.classList.remove('active', 'completed');
        if (i < index) item.classList.add('completed');
    });

    startTimer();


}


 function selectAnswer(selectedIndex) {
    const answerTime = (Date.now() - currentGameState.questionStartTime) / 1000;
    currentGameState.userTimes.push(answerTime);

    const question = currentGameState.selectedQuestions[currentGameState.currentQuestionIndex];
    const isCorrect = selectedIndex === question.correct;

    currentGameState.userAnswers.push({
        selected: selectedIndex,
        correct: isCorrect,
        time: answerTime
    });

    if (selectedIndex !== -1) {
        const options = document.querySelectorAll('.option-btn');
        options[selectedIndex].classList.add('selected');
    }

    if (isCorrect) {
        currentGameState.userScore++;
    }

    const userIndicator = document.getElementById(`userQ${currentGameState.currentQuestionIndex}`);
    userIndicator.className = `w-3 h-3 rounded-full ${isCorrect ? 'bg-green-500' : 'bg-red-500'}`;

    clearInterval(currentGameState.gameTimer);

    setTimeout(() => {
        if (currentGameState.currentQuestionIndex < 9) {
            showQuestion(currentGameState.currentQuestionIndex + 1);
        } else {
            endGame();
        }
    }, 1000);
}

 
        function startTimer() {
            let timeLeft = 10;
            document.getElementById('timeLeft').textContent = timeLeft;
            
            currentGameState.gameTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('timeLeft').textContent = timeLeft;
                document.getElementById('timerBar').style.width = (timeLeft / 10) * 100 + '%';
                
                if (timeLeft <= 0) {
                    clearInterval(currentGameState.gameTimer);
                    selectAnswer(-1); // Auto-submit with no selection
                }
            }, 1000);
        }


		
function endGame() {
    if (currentGameState.gameEnded) return; // ‚õî prevent repeat calls
    currentGameState.gameEnded = true; // ‚úÖ mark as ended

    const userScore = currentGameState.userScore;
    const botShouldWin = Math.random() < 0.7;
    
    if (botShouldWin) {
        if (userScore < 9) {
            currentGameState.botScore = userScore + Math.floor(Math.random() * 2) + 1;
        } else {
            currentGameState.botScore = userScore;
        }
        currentGameState.botScore = Math.min(currentGameState.botScore, 10);
    } else {
        const penalty = Math.floor(Math.random() * 3) + 1;
        currentGameState.botScore = Math.max(0, userScore - penalty);
    }

    // Update bot visual indicators
    for (let i = 0; i < 10; i++) {
        const botIndicator = document.getElementById(`botQ${i}`);
        const isCorrect = i < currentGameState.botScore;
        botIndicator.className = `w-3 h-3 rounded-full ${isCorrect ? 'bg-green-500' : 'bg-red-500'}`;
    }

    setTimeout(() => {
        showResults();
    }, 2000);
}

async function showResults() {
            const userWon = currentGameState.userScore > currentGameState.botScore;
            const winAmount = Math.floor(currentGameState.playAmount * 2);
            document.getElementById('winAmount').textContent = winAmount;
document.getElementById('winningSection').classList.remove('hidden');

            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultScreen').classList.remove('hidden');

            // Update result display
if (userWon) {
    document.getElementById('resultIcon').innerHTML = '<i class="fas fa-trophy text-yellow-400"></i>';
    document.getElementById('resultTitle').textContent = 'Victory!';
    document.getElementById('resultTitle').className = 'text-3xl font-bold mb-2 text-green-400';
    document.getElementById('resultSubtitle').textContent = 'You defeated the bot!';
    document.getElementById('winAmount').textContent = winAmount;
    document.getElementById('winningSection').classList.remove('hidden');

    // ‚úÖ Update wallet in Firestore
    const user = window.auth.currentUser;
    if (user) {
        const userRef = window.doc(window.db, "users", user.uid);
        await window.setDoc(userRef, {
            winningWallet: window.increment(winAmount)
        }, { merge: true });

        const snap = await window.getDoc(userRef);
        const newWalletAmount = snap.data().winningWallet || 0;
        const walletElem = document.getElementById("winning-wallet");
        if (walletElem) walletElem.innerText = newWalletAmount;
    }

    // üéâ Show confetti
    showConfetti();
} else {
                document.getElementById('resultIcon').innerHTML = '<i class="fas fa-robot text-red-400"></i>';
                document.getElementById('resultTitle').textContent = 'Defeated!';
                document.getElementById('resultTitle').className = 'text-3xl font-bold mb-2 text-red-400';
                document.getElementById('resultSubtitle').textContent = 'The bot was too smart this time!';
                document.getElementById('winningSection').classList.add('hidden');
            }

            // Update scores
            document.getElementById('userScore').textContent = `${currentGameState.userScore}/10`;
            document.getElementById('botScore').textContent = `${currentGameState.botScore}/10`;
            
            // Calculate average times
            const userAvgTime = currentGameState.userTimes.length > 0 ? 
                (currentGameState.userTimes.reduce((a, b) => a + b, 0) / currentGameState.userTimes.length).toFixed(1) : 'N/A';
            const botAvgTime = currentGameState.botTimes.length > 0 ? 
                (currentGameState.botTimes.reduce((a, b) => a + b, 0) / currentGameState.botTimes.length).toFixed(1) : 'N/A';
            
            document.getElementById('userAvgTime').textContent = userAvgTime;
            document.getElementById('botAvgTime').textContent = botAvgTime;
			
			if (userWon === false && currentGameState.userScore === 10 && currentGameState.botScore === 10) {
  // Make bot seem slower if it wins despite user getting full score
  currentGameState.botTimes = currentGameState.botTimes.map(t => t + 1.5);
  
  
}
await saveBotMatchResult(userWon, winAmount);



        }

async function saveBotMatchResult(userWon, winAmount) {
    const user = window.auth.currentUser;
    if (!user) return;

    const resultData = {
        uid: user.uid,
        playAmount: currentGameState.playAmount,
        userScore: currentGameState.userScore,
        botScore: currentGameState.botScore,
        userTimes: currentGameState.userTimes,
        botTimes: currentGameState.botTimes,
        userWon: userWon,
        winAmount: userWon ? winAmount : 0,
		botLevel: botLevel,
        timestamp: new Date().toISOString()
    };

    try {
        const matchRef = window.doc(window.db, `botMatches/${user.uid}_${Date.now()}`);
        await window.setDoc(matchRef, resultData);
        console.log("Bot match result saved successfully.");
    } catch (error) {
        console.error("Failed to save bot match result:", error);
    }
}

        function showConfetti() {
            const canvas = document.getElementById('confettiCanvas');
            const ctx = canvas.getContext('2d');
            canvas.classList.remove('hidden');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const confettiPieces = [];
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7'];
            
            for (let i = 0; i < 150; i++) {
                confettiPieces.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    w: Math.random() * 10 + 5,
                    h: Math.random() * 10 + 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    vx: Math.random() * 4 - 2,
                    vy: Math.random() * 6 + 2,
                    rotation: Math.random() * 360,
                    rotationSpeed: Math.random() * 10 - 5
                });
            }
            
            function animateConfetti() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                confettiPieces.forEach((piece, index) => {
                    piece.x += piece.vx;
                    piece.y += piece.vy;
                    piece.rotation += piece.rotationSpeed;
                    
                    ctx.save();
                    ctx.translate(piece.x + piece.w / 2, piece.y + piece.h / 2);
                    ctx.rotate(piece.rotation * Math.PI / 180);
                    ctx.fillStyle = piece.color;
                    ctx.fillRect(-piece.w / 2, -piece.h / 2, piece.w, piece.h);
                    ctx.restore();
                    
                    if (piece.y > canvas.height) {
                        confettiPieces.splice(index, 1);
                    }
                });
                
                if (confettiPieces.length > 0) {
                    requestAnimationFrame(animateConfetti);
                } else {
                    canvas.classList.add('hidden');
                }
            }
            
            animateConfetti();
        }

        function saveGameHistory(userWon, winAmount) {
            const history = JSON.parse(localStorage.getItem('quizHistory') || '[]');
            const gameRecord = {
                date: new Date().toISOString(),
                userScore: currentGameState.userScore,
                botScore: currentGameState.botScore,
                winner: userWon ? 'user' : 'bot',
                playAmount: currentGameState.playAmount,
                winAmount: userWon ? winAmount : 0,
                totalTime: Math.floor((Date.now() - currentGameState.startTime) / 1000)
            };
            
            history.push(gameRecord);
            localStorage.setItem('quizHistory', JSON.stringify(history));
        }

        function playAgain() {
            // Reset game state
            currentGameState = {
                playAmount: 0,
                currentQuestionIndex: 0,
                userAnswers: [],
                userScore: 0,
                botScore: 0,
                selectedQuestions: [],
                startTime: 0,
                questionStartTime: 0,
                userTimes: [],
                botTimes: [],
                gameTimer: null,
                botTimer: null
            };
            
            document.getElementById('resultScreen').classList.add('hidden');
            document.getElementById('entryScreen').classList.remove('hidden');
        }

        function goHome() {
            // In a real app, this would navigate to dashboard
            window.location.href = '/dashboard.html';
        }

        // Handle window resize for confetti
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('confettiCanvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script><span id="winning-wallet"></span>
<span id="recharge-wallet"></span>
</body>
</html>
